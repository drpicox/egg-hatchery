{"version":3,"file":"egg-hatchery.umd.js","sources":["../src/breedEgg.js","../src/newTools.js","../src/normalizeEggs.js","../src/index.js"],"sourcesContent":["const { defineProperty } = Object;\n\nexport default tools => {\n  const { tool } = tools;\n\n  const breeds = Object.create(null);\n  const frozenBreeds = Object.freeze(Object.create(breeds));\n  const factories = Object.create(null);\n\n  function validateBreedContext() {\n    if (tools.isHatched)\n      throw new Error('breed a hatching breed fails when hatch is finished');\n  }\n\n  function validateBreedName(name) {\n    if (!name || typeof name !== 'string')\n      throw new Error(\n        `invalid breed name, expected the first argument to be a non-empty string but received \"${name}\"`\n      );\n  }\n\n  function validateBreedFactory(factory) {\n    if (typeof factory !== 'function')\n      throw new Error(\n        `invalid breed function, expected the second argument to be a function but received \"${factory}\"`\n      );\n  }\n\n  function breed(name, factory) {\n    validateBreedContext();\n    validateBreedName(name);\n    validateBreedFactory(factory);\n\n    const uberFactory = factories[name];\n    const localBreeds = Object.create(breeds);\n    defineProperty(localBreeds, name, { get: uberFactory });\n    Object.freeze(localBreeds);\n\n    let isComputed = false;\n    let isComputing = false;\n    let memoizedValue;\n    const breedFactory = () => {\n      if (!tools.isHatched)\n        throw new Error('breeds object cannot be used until eggs hatch');\n\n      if (isComputed) return memoizedValue;\n      if (isComputing)\n        throw new Error(\n          `breed cycle detected, it uses breeds that uses \"${name}\"`\n        );\n\n      isComputing = true;\n      memoizedValue = factory(localBreeds);\n\n      isComputed = true;\n      return memoizedValue;\n    };\n\n    factories[name] = breedFactory;\n\n    defineProperty(breeds, name, {\n      get: breedFactory,\n      configurable: true\n    });\n  }\n\n  tool('breed', breed);\n  tool('breeds', frozenBreeds);\n};\n","export default function newTools() {\n  const tools = Object.create(null);\n\n  tools.tool = (name, value) => {\n    if (!name || typeof name !== 'string')\n      throw new Error(\n        `invalid tool name, expected the first argument to be a non-empty string but received \"${name}\"`\n      );\n\n    if (tools.isHatched)\n      throw new Error(\n        `invalid state exception, cannot define more tools once the egg is hatched`\n      );\n\n    tools[name] = value;\n  };\n\n  tools.isHatched = false;\n\n  const frozenTools = Object.freeze(Object.create(tools));\n  return frozenTools;\n}\n","function normalizeEggs(...eggs) {\n  const eggsSet = new Set();\n\n  function addEggs(nextEggs) {\n    for (let i = 0; i < nextEggs.length; i++)\n      if (Array.isArray(nextEggs[i])) addEggs(nextEggs[i]);\n      else eggsSet.add(nextEggs[i]);\n  }\n\n  addEggs(eggs);\n\n  return [...eggsSet];\n}\n\nexport default normalizeEggs;\n","import breedEgg from './breedEgg';\nimport newTools from './newTools';\nimport normalizeEggs from './normalizeEggs';\n\nfunction validateEggs(eggs) {\n  for (let i = 0; i < eggs.length; i++)\n    if (typeof eggs[i] !== 'function')\n      throw new Error(\n        `received egg is not an egg, expected a function but received \"${eggs[i]}\"`\n      );\n}\n\nfunction hatchEggs(eggs, tools) {\n  for (let i = 0; i < eggs.length; i++) eggs[i](tools);\n}\n\nexport default function hatch(...eggs) {\n  const tools = newTools();\n  const uniqueEggs = normalizeEggs(breedEgg, eggs);\n\n  validateEggs(uniqueEggs);\n  hatchEggs(uniqueEggs, tools);\n\n  const breeds = tools.breeds;\n  tools.tool('isHatched', true);\n\n  return breeds;\n}\n"],"names":["defineProperty","Object","tools","tool","breeds","create","frozenBreeds","freeze","factories","validateBreedContext","isHatched","Error","validateBreedName","name","validateBreedFactory","factory","uberFactory","localBreeds","get","isComputed","isComputing","memoizedValue","breedFactory","configurable","newTools","value","frozenTools","normalizeEggs","eggsSet","Set","addEggs","nextEggs","i","length","Array","isArray","add","eggs","validateEggs","hatchEggs","hatch","uniqueEggs","breedEgg"],"mappings":"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"}